package cep;

import com.ftn.sbnz.model.HeadshotKillEvent
import com.ftn.sbnz.model.RegularKillEvent
import com.ftn.sbnz.model.User
import com.ftn.sbnz.model.UtilityUsageEvent
import com.ftn.sbnz.model.GameEndedEvent
import com.ftn.sbnz.model.Game
import com.ftn.sbnz.model.WallbangEvent
import com.ftn.sbnz.model.GameStatistic
import com.ftn.sbnz.model.AimbotReportCooldown
import com.ftn.sbnz.model.WallhackReportCooldown
import com.ftn.sbnz.model.UserProcessed
import com.ftn.sbnz.model.AimbotAnalasisEvent;
import com.ftn.sbnz.model.SuspicionLevelRaisedEvent;
import com.ftn.sbnz.model.enums.Report
import com.ftn.sbnz.model.enums.SuspicionLevel



rule "AIMBOT Headshot Kill Rule"
when
    $event: HeadshotKillEvent($gameStatId: gameStatisticId)
    $statistic: GameStatistic(id == $gameStatId)
    exists(not AimbotReportCooldown(gameStatisticId == $gameStatId) over window: time(1m))
    Number(intValue >= 5) from accumulate(
        HeadshotKillEvent(gameStatisticId == $gameStatId) over window:time(5m),
        count()
    )
then
    System.out.println("AIMBOT Headshot Kill Rule activated!");
    $statistic.getReports().add(Report.AIMBOT);
    update($statistic);
    insert(new AimbotReportCooldown($gameStatId));
end

rule "AIMBOT Headshot and Utility Usage Rule"
when
    $headshotEvent: HeadshotKillEvent($gameStatId: gameStatisticId)
    $statistic: GameStatistic(id == $gameStatId)
    exists(not AimbotReportCooldown(gameStatisticId == $gameStatId) over window: time(1m))
    Number(intValue >= 3) from accumulate(
        HeadshotKillEvent(gameStatisticId == $gameStatId) over window:time(5m),
        count()
    )
    Number(intValue >= 5) from accumulate(
        UtilityUsageEvent(gameStatisticId == $gameStatId) over window:time(2m),
        count()
    )
then
    $statistic.getReports().add(Report.AIMBOT);
    System.out.println("AIMBOT Headshot Kill Rule activated! 2");
    update($statistic);
    insert(new AimbotReportCooldown($gameStatId));
end

rule "WALLHACK Wallbang Kill Rule"
when
    $wallbangEvent: WallbangEvent($gameStatId: gameStatisticId)
    $statistic: GameStatistic(id == $gameStatId)
    exists(not WallhackReportCooldown(gameStatisticId == $gameStatId) over window: time(1m))
    Number(intValue >= 5) from accumulate(
        WallbangEvent(gameStatisticId == $gameStatId) over window:time(5m),
        count()
    )
then
    $statistic.getReports().add(Report.WALLHACK);
        System.out.println("AIMBOT Headshot Kill Rule activated! 3");
    update($statistic);
    insert(new WallhackReportCooldown($gameStatId));
end
